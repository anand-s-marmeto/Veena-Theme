{% liquid
  assign current_variant = product.selected_or_first_available_variant
  assign featured_image = current_variant.image | default: product.featured_image
  assign secondary_image = product.images[1] | default: product.featured_image
%}

{%  style  %} 
  .product-card__swatch{
    display: block;
    width:10px;
    height:10px;
    border-radius:50%;
  }
{% endstyle %} 

<product-card 
  class="product-card"
  data-product-handle="{{ product.handle }}" 
  data-section-id="{{ section_id }}"
>
  <a href="{{ product.url }}" class="media media--portrait media--hover-effect product-card-image">
    <img
        srcset="
          {%- if featured_image.width >= 165 -%}{{ featured_image | image_url: width: 165 }} 165w,{%- endif -%}
          {%- if featured_image.width >= 360 -%}{{ featured_image | image_url: width: 360 }} 360w,{%- endif -%}
          {%- if featured_image.width >= 533 -%}{{ featured_image | image_url: width: 533 }} 533w,{%- endif -%}
          {%- if featured_image.width >= 720 -%}{{ featured_image | image_url: width: 720 }} 720w,{%- endif -%}
          {%- if featured_image.width >= 940 -%}{{ featured_image | image_url: width: 940 }} 940w,{%- endif -%}
          {%- if featured_image.width >= 1066 -%}{{ featured_image | image_url: width: 1066 }} 1066w,{%- endif -%}
          {{ featured_image | image_url }} {{ featured_image.width }}w
        "
        src="{{ featured_image | image_url: width: 533 }}"
        sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
        alt="{{ featured_image.alt | escape }}"
        class="motion-reduce"
        {% unless lazy_load == false %}
          loading="lazy"
        {% endunless %}
        width="{{ featured_image.width }}"
        height="{{ featured_image.height }}"
      >     
      <img
        srcset="
          {%- if secondary_image.width >= 165 -%}{{ secondary_image | image_url: width: 165 }} 165w,{%- endif -%}
          {%- if secondary_image.width >= 360 -%}{{ secondary_image | image_url: width: 360 }} 360w,{%- endif -%}
          {%- if secondary_image.width >= 533 -%}{{ secondary_image | image_url: width: 533 }} 533w,{%- endif -%}
          {%- if secondary_image.width >= 720 -%}{{ secondary_image | image_url: width: 720 }} 720w,{%- endif -%}
          {%- if secondary_image.width >= 940 -%}{{ secondary_image | image_url: width: 940 }} 940w,{%- endif -%}
          {%- if secondary_image.width >= 1066 -%}{{ secondary_image | image_url: width: 1066 }} 1066w,{%- endif -%}
          {{ secondary_image | image_url }} {{ secondary_image.width }}w
        "
        src="{{ secondary_image | image_url: width: 533 }}"
        sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
        alt=""
        class="motion-reduce"
        loading="lazy"
        width="{{ secondary_image.width }}"
        height="{{ secondary_image.height }}"
      >
    <div class="card-button">
      <div class="product-tags">
        {% if product.tags %}
        <div class="arrival-tag">{{ product.tags[0] }}</div>
        {% endif %}
        {% if current_variant.compare_at_price > current_variant.price %}
          <div class="discount-tag">{{ current_variant.compare_at_price | minus: current_variant.price | times: 100 | divided_by: current_variant.compare_at_price }}% Off</div>
        {% endif %}
      </div>
    <div class="product-card-button" href="{{ current_variant.url }}"><span>Quick look</span></div>
    </div>
  </a>
  <div class="product-card-info">
      <div class='jdgm-widget jdgm-preview-badge'>
      {{ product.metafields.judgeme.badge }}
  </div>
    
    {% comment %} Variants {% endcomment %}
    <div class="product-card__form">
      {% form 'product', product %}
        <input type="hidden" name="id" value="{{ current_variant.id }}">
        {% unless product.has_only_default_variant %}
          <div class="product-card__options"> 
            {% for product_option in product.options_with_values %}
              {% comment %} Converts the option name to a lowercase value {% endcomment %}
              {% assign downcased_option_name = product_option.name |  handleize %} 
                
                <div class="product-card__option">
                  <ul class="product-variants">
                    {% for option_value in product_option.values %}
                      {% assign downcased_option_value = option_value | handleize %}
                      <li class="item-swatch">
                        <label for="product-card-{{ product_option.name | escape }}-{{ forloop.index }}" class="product-card__label">
                        {% if downcased_option_name == 'color' %} 
                        <input 
                          type="radio" 
                          style="visibility: hidden;"
                          name="option-{{ downcased_option_name | handleize }}" 
                          value="{{ option_value }}"
                          {% if product_option.selected_value == option_value %}checked{% endif %}
                        >
                        {% assign swatch_image = downcased_option_value | append: '.jpg' | file_url %}
                          <span
                            class="product-card__swatch product-card__colorswatch"
                            style="background-color: {{ downcased_option_value  |  handleize}};"
                          >
                          </span>
                        {% comment %} Showing other variant options if color is not there. {% endcomment %}
                        {% else %}
                          <input 
                            type="radio"
                            name="option-{{ downcased_option_name | handleize }}" 
                            value="{{ option_value }}"
                            {% if product_option.selected_value == option_value %}checked{% endif %}
                          >
                            <span class="product-card__swatch">{{ option_value }}</span>
                        {% endif %}
                        </label>
                      </li>
                      
                    {% endfor %}
                  </ul>
                </div>
            {% endfor %}
          </div>
        {% endunless %}
        
      {% endform %}
    </div>

    

    {% comment %} {%- if product.metafields.reviews.rating.value != blank -%}
      {% liquid
        assign rating_decimal = 0
        assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1
        if decimal >= 0.3 and decimal <= 0.7
          assign rating_decimal = 0.5
        elsif decimal > 0.7
          assign rating_decimal = 1
        endif
      %}
      <div
        class="rating"
        role="img"
        aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}"
      >
        <span
          aria-hidden="true"
          class="rating-star"
          style="--rating: {{product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
        ></span>
      </div>
      <p class="rating-text caption">
        <span aria-hidden="true">
          {{- product.metafields.reviews.rating.value }} /
          {{ product.metafields.reviews.rating.value.scale_max -}}
        </span>
      </p>
      <p class="rating-count caption">
        <span aria-hidden="true">({{ product.metafields.reviews.rating_count }})</span>
        <span class="visually-hidden">
          {{- product.metafields.reviews.rating_count }}
          {{ 'accessibility.total_reviews' | t -}}
        </span>
      </p>
    {%- endif -%} {% endcomment %}

    <div class="product-vendor">
      {{ product.vendor }}
    </div>
    <h3 class="product-title h5">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>
    <div class="product-price">
      <div class="regular-price">{{ current_variant.price |  money_with_currency}}</div>
      <s class="compare-price">{{ current_variant.compare_at_price |  money_with_currency }}</s>
    </div>
  </div>
  
  <script>
    {{ product.variants | json }}
  </script>
</product-card>